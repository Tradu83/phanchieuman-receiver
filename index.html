<!DOCTYPE html>
<html>
<head>
  <title>Chiếu Phone Receiver</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background-color: #000;
    }
    video {
      width: 100%;
      height: 100%;
      object-fit: contain; /* Giữ tỷ lệ khung hình, không bị méo */
    }
  </style>
  <script type="text/javascript" src="//www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js"></script>
</head>
<body>
  <video id="videoPlayer" autoplay></video>

  <script>
    const context = cast.framework.CastReceiverContext.getInstance();
    const playerManager = context.getPlayerManager();

    // Lắng nghe sự kiện khi Sender gửi yêu cầu LOAD
    playerManager.setMessageInterceptor(
      cast.framework.messages.MessageType.LOAD,
      (loadRequestData) => {
        console.log("LOAD request received:", loadRequestData);

        // Lấy URL video stream từ customData
        const videoUrl = loadRequestData.media.customData.videoUrl;

        if (!videoUrl) {
          console.error("Video URL is missing in customData");
          return new cast.framework.messages.ErrorData(
            cast.framework.messages.ErrorType.LOAD_FAILED
          );
        }
        
        const videoElement = document.getElementById('videoPlayer');
        videoElement.src = videoUrl;
        videoElement.play().catch(error => {
          console.error("Error trying to play video:", error);
        });

        // Thông báo rằng media đã được tải thành công
        // Chúng ta sẽ bỏ qua việc quản lý trạng thái media phức tạp
        // vì đây là một luồng trực tiếp đơn giản.
        // Trả về null để cho phép trình phát mặc định xử lý.
        // Tuy nhiên, vì chúng ta tự xử lý thẻ <video>, ta sẽ ngăn chặn
        // trình phát mặc định bằng cách không trả về request.
        // Hoặc đơn giản là trả về một thông báo thành công.
        
        // Để đơn giản, chỉ cần phát video và không làm gì thêm.
        // Trả về một đối tượng request đã được sửa đổi (hoặc không) để cho phép tải.
        // Ở đây ta tự xử lý nên chỉ cần return request ban đầu.
        return loadRequestData;
      }
    );

    // Bắt đầu Cast Receiver Context
    context.start();
    console.log("Cast Receiver started.");
  </script>
</body>
</html>
