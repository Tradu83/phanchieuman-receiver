<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Phan Chieu Man Hinh Receiver</title>
  <link rel="stylesheet" href="receiver.css">
  <script type="text/javascript" src="//www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js"></script>
</head>
<body>
  <cast-media-player></cast-media-player>
  
  <div id="waiting-screen">
    <img src="logo.png" alt="App Logo">
    <h1>Phan Chieu Man Hinh</h1>
    <p>Sẵn sàng để nhận nội dung...</p>
  </div>

  <script>
    // Lấy các đối tượng quản lý chính của Cast
    const context = cast.framework.CastReceiverContext.getInstance();
    const playerManager = context.getPlayerManager();

    // Lấy các phần tử HTML
    const waitingScreen = document.getElementById('waiting-screen');
    const playerElement = document.querySelector('cast-media-player');

    // Tối ưu hóa cho việc nhận luồng trực tiếp (quan trọng cho phản chiếu màn hình sau này)
    const playbackConfig = new cast.framework.PlaybackConfig();
    playbackConfig.livePlaybackRebufferDuration = 2; // Giảm thời gian đệm
    playbackConfig.autoResumeDuration = 1;

    // Lắng nghe các sự kiện từ playerManager
    playerManager.addEventListener(
      cast.framework.events.EventType.PLAYER_LOADING,
      () => {
        // Khi media bắt đầu được tải, ẩn màn hình chờ và hiện trình phát
        waitingScreen.style.display = 'none';
        playerElement.style.display = 'block';
      }
    );

    // Lắng nghe sự kiện kết thúc hoặc dừng
    playerManager.addEventListener(
        cast.framework.events.EventType.REQUEST_STOP,
        () => {
            // Khi dừng, ẩn trình phát và hiện lại màn hình chờ
            waitingScreen.style.display = 'flex';
            playerElement.style.display = 'none';
        }
    );
     playerManager.addEventListener(
        cast.framework.events.EventType.PLAYER_STATE_CHANGED,
        (event) => {
            if (event.playerState === cast.framework.messages.PlayerState.IDLE &&
                event.currentMedia === null) {
                waitingScreen.style.display = 'flex';
                playerElement.style.display = 'none';
            }
        }
    );


    // Khởi động Cast Receiver Framework
    context.start({
        playbackConfig: playbackConfig,
        // Hỗ trợ các lệnh media cơ bản
        supportedCommands: cast.framework.messages.Command.ALL_BASIC_MEDIA
    });
  </script>
</body>
</html>