<!DOCTYPE html>
<html>
<head>
    <title>Chiếu Phone Receiver</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background-color: #000; }
        img { width: 100%; height: 100%; object-fit: contain; }
    </style>
    <script type="text/javascript" src="//www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js"></script>
</head>
<body>
    <img id="player" />

    <script>
        const context = cast.framework.CastReceiverContext.getInstance();
        const imageElement = document.getElementById('player');

        // === THAY ĐỔI LỚN Ở ĐÂY ===
        // 1. Định nghĩa một không gian tên (namespace) tùy chỉnh.
        //    Nó phải khớp với namespace trên ứng dụng Android.
        const NAMESPACE = 'urn:x-cast:com.tranduyen.chieuphone.custom';

        // 2. Lắng nghe tin nhắn trên không gian tên này, thay vì dùng PlayerManager.
        context.addCustomMessageListener(NAMESPACE, (event) => {
            console.log('Custom message received:', event.data);

            // Giả sử dữ liệu gửi từ điện thoại là một JSON string: {"url": "http://..."}
            try {
                const data = JSON.parse(event.data);
                if (data.url) {
                    console.log('Setting image source to:', data.url);
                    imageElement.src = data.url;
                }
            } catch (e) {
                console.error("Failed to parse custom message data", e);
            }
        });

        // Bắt đầu Cast Receiver Context
        context.start({
            // Không cần các cấu hình media phức tạp nữa
            maxInactivity: 3600 // Giữ session active trong 1 giờ
        });
        console.log('Cast Receiver started and listening for custom messages.');
    </script>
</body>
</html>
